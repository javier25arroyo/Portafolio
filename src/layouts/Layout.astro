---
import ThemeToggleButton from '../components/ThemeToggleButton.astro';
import '../styles/global.css';
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>Professional Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
      .theme-transition-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
        background: transparent;
        transform-origin: top right;
        transition: none;
      }

      .theme-transition-overlay.transitioning-to-dark {
        background: rgba(17, 24, 39, 0.4);
        clip-path: circle(0% at 85% 60px);
        animation: expandRoomDark 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      }

      .theme-transition-overlay.transitioning-to-light {
        background: rgba(243, 244, 246, 0.4);
        clip-path: circle(0% at 85% 60px);
        animation: expandRoomLight 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      }

      @keyframes expandRoomDark {
        0% {
          clip-path: circle(0% at 85% 60px);
        }
        30% {
          clip-path: circle(20% at 85% 60px);
        }
        100% {
          clip-path: circle(140% at 85% 60px);
        }
      }

      @keyframes expandRoomLight {
        0% {
          clip-path: circle(0% at 85% 60px);
        }
        30% {
          clip-path: circle(20% at 85% 60px);
        }
        100% {
          clip-path: circle(140% at 85% 60px);
        }
      }

      /* Prevent theme flicker during transition */
      html.theme-transitioning * {
        transition: none !important;
      }
    </style>
  </head>
    <body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans" style="transition: background-color 0.5s, color 0.5s;">
    <!-- Theme Transition Overlay -->
    <div id="theme-transition-overlay" class="theme-transition-overlay"></div>
    
    <header class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-md shadow-sm border-b border-slate-200 dark:border-slate-700 sticky top-0 z-50">
      <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
            <span class="text-white font-bold text-sm">JA</span>
          </div>
          <h1 class="text-xl font-bold bg-gradient-to-r from-slate-800 to-blue-600 dark:from-slate-100 dark:to-blue-400 bg-clip-text text-transparent">
            Javier Arroyo
          </h1>
        </div>
        <ThemeToggleButton />
      </div>
    </header>
    <main class="min-h-screen">
      <slot />
    </main>
    <footer class="bg-white dark:bg-slate-800 mt-8 py-8 border-t border-slate-200 dark:border-slate-700">
      <div class="container mx-auto px-6 text-center">
        <div class="flex flex-col items-center gap-4">
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center">
              <span class="text-white font-bold text-xs">JA</span>
            </div>
            <span class="text-slate-600 dark:text-slate-400 font-medium">
              &copy; {new Date().getFullYear()} Javier Pérez Arroyo
            </span>
          </div>
          <p class="text-sm text-slate-500 dark:text-slate-500">
            Built with ❤️ using Astro & Tailwind CSS
          </p>
        </div>
      </div>
    </footer>
    
    <script>
      function initializeTheme() {
        // Detecta el tema inicial
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }

      function toggleThemeWithAnimation() {
        const html = document.documentElement;
        const overlay = document.getElementById('theme-transition-overlay');
        const isDark = html.classList.contains('dark');
        
        // Verificar que el overlay existe
        if (!overlay) return;
        
        // Prevenir múltiples animaciones simultáneas
        if (overlay.classList.contains('transitioning-to-dark') || 
            overlay.classList.contains('transitioning-to-light')) {
          return;
        }
        
        // Agregar clase de transición para prevenir parpadeos
        html.classList.add('theme-transitioning');
        
        // Configurar la animación según el tema actual
        if (isDark) {
          // Cambiar a tema claro
          overlay.classList.add('transitioning-to-light');
        } else {
          // Cambiar a tema oscuro
          overlay.classList.add('transitioning-to-dark');
        }
        
        // Cambiar el tema después de un pequeño delay para que se vea la animación
        setTimeout(() => {
          if (isDark) {
            html.classList.remove('dark');
            localStorage.setItem('theme', 'light');
          } else {
            html.classList.add('dark');
            localStorage.setItem('theme', 'dark');
          }
        }, 300);
        
        // Limpiar las clases de animación después de que termine
        setTimeout(() => {
          if (overlay) {
            overlay.classList.remove('transitioning-to-dark', 'transitioning-to-light');
          }
          html.classList.remove('theme-transitioning');
        }, 1000);
      }

      // Exponer la función globalmente para que el botón pueda usarla
      (window as any).toggleThemeWithAnimation = toggleThemeWithAnimation;

      // Inicializar el tema cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeTheme);
      } else {
        initializeTheme();
      }
    </script>
  </body>
</html>