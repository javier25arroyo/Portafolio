---
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';
import '../styles/shared.css';
import  SpeedInsights  from "@vercel/speed-insights/astro"
---
<!doctype html>
<html lang="en" class="font-sans scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Script para corregir rutas en GitHub Pages -->
    <script is:inline define:vars={{ baseUrl: import.meta.env.BASE_URL }}>
      // Cargar el script de corrección de rutas dinámicamente
      const script = document.createElement('script');
      script.src = baseUrl + '/fixPaths.js';
      document.head.appendChild(script);
    </script>
    
    <!-- Favicon configuration - Multiple formats for maximum compatibility -->
    <link rel="icon" type="image/x-icon" href={`${import.meta.env.BASE_URL}/favicon.ico`} />
    <link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}/assets/icons/favicon.ico`} />
    <link rel="icon" type="image/png" sizes="32x32" href={`${import.meta.env.BASE_URL}/assets/icons/favicon.ico`} />

    <!-- Theme color for browser UI -->
    <meta name="theme-color" content="#4F46E5" />
    <meta name="msapplication-TileColor" content="#4F46E5" />
    
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO Mejorado -->
    <title>Javier_cr | Portfolio</title>
    <meta name="description" content="Software Developer specializing in modern web technologies. View my portfolio of projects and skills." />
    <meta name="keywords" content="software developer, web developer, portfolio, JavaScript, TypeScript, React, Node.js" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="Javier Arroyo - Software Developer" />
    <meta property="og:description" content="Software Developer specializing in modern web technologies" />
    <meta property="og:type" content="website" />
    
    <!-- Fonts optimizados -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <style>
      /* === ESTILOS BASE MEJORADOS === */
      *, *::before, *::after {
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
        scroll-padding-top: 80px;
      }

      body {
        margin: 0;
        padding: 0;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-family: 'Montserrat', sans-serif;
        line-height: 1.6;
        overflow-x: hidden;
        transition: all var(--transition-normal);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      /* === EFECTOS DE CARGA === */
      .page-loading {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                    transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .page-loaded {
        opacity: 1;
        transform: translateY(0);
      }

      /* === SCROLLBAR PERSONALIZADA === */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-surface);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, var(--color-primary), var(--color-secondary));
        border-radius: 4px;
        transition: all var(--transition-normal);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, var(--color-primary-light), var(--color-secondary-light));
      }

      /* === SELECCIÓN DE TEXTO === */
      ::selection {
        background: rgba(79, 70, 229, 0.3);
        color: var(--text-primary);
      }

      /* === ACCESIBILIDAD === */
      :focus-visible {
        outline: 3px solid var(--color-primary);
        outline-offset: 2px;
        border-radius: 8px;
        box-shadow: 0 0 0 6px rgba(79, 70, 229, 0.2);
      }

      /* === EFECTOS DE FONDO === */
      .bg-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        opacity: 0.03;
      }

      .bg-particles::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          radial-gradient(circle at 20% 80%, var(--color-primary) 1px, transparent 1px),
          radial-gradient(circle at 80% 20%, var(--color-secondary) 1px, transparent 1px),
          radial-gradient(circle at 40% 40%, var(--color-accent) 1px, transparent 1px);
        background-size: 100px 100px, 150px 150px, 200px 200px;
        animation: float 20s ease-in-out infinite;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        33% { transform: translateY(-10px) rotate(1deg); }
        66% { transform: translateY(5px) rotate(-1deg); }
      }

      /* === REVEAL ANIMATIONS === */
      .reveal {
        opacity: 0;
        transform: translateY(50px);
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .reveal.revealed {
        opacity: 1;
        transform: translateY(0);
      }

      /* === TIPOGRAFÍA === */
      h1, h2, h3, h4, h5, h6 {
        font-weight: 700;
        line-height: 1.2;
        letter-spacing: -0.02em;
        margin: 0;
      }

      p {
        line-height: 1.7;
        margin: 0;
      }

      /* === RESPONSIVE === */
      @media (max-width: 768px) {
        html {
          scroll-padding-top: 60px;
        }
        
        .page-loading {
          transform: translateY(20px);
        }
      }

      /* === ACCESIBILIDAD - MOVIMIENTO REDUCIDO === */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
        
        html {
          scroll-behavior: auto;
        }
      }
    </style>
  </head>
  
  <body class="page-loading">
    <!-- Elementos de fondo -->
    <div class="bg-particles"></div>
    
    <!-- Navegación -->
    <Navigation />
    
    <!-- Contenido principal -->
    <main class="min-h-screen">
      <slot />
    </main>
    
    <!-- Footer -->
    <Footer />
    
    <!-- Componentes UX -->
    <div id="scroll-progress" class="fixed top-0 left-0 w-full h-1 z-50 scroll-progress-bg">
      <div id="scroll-progress-bar" class="h-full transition-all duration-300 ease-out scroll-progress-bar" style="width: 0%;"></div>
    </div>
    <button 
      id="back-to-top" 
      class="fixed bottom-8 right-8 w-14 h-14 rounded-full shadow-lg transition-all duration-300 transform opacity-0 pointer-events-none z-40 glass-elevated hover:neon-glow back-to-top-btn"
      aria-label="Back to top"
      data-track="back-to-top"
    >
      <svg class="w-6 h-6 mx-auto back-to-top-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
      </svg>
    </button>
    <div id="page-loader" class="fixed inset-0 z-50 flex items-center justify-center transition-opacity duration-500 page-loader">
      <div class="flex flex-col items-center">
        <div class="w-12 h-12 border-4 border-transparent rounded-full animate-spin mb-4 loader-spinner"></div>
        <p class="loader-text">Loading amazing content...</p>
      </div>
    </div>

    <script>
      // === INICIALIZACIÓN DE LA PÁGINA ===
      document.addEventListener('DOMContentLoaded', () => {
        // Marcar página como cargada
        setTimeout(() => {
          document.body.classList.remove('page-loading');
          document.body.classList.add('page-loaded');
        }, 100);

        // === SISTEMA DE REVEAL ===
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.classList.add('revealed');
              }, index * 100);
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        document.querySelectorAll('.reveal').forEach(el => {
          observer.observe(el);
        });

        // === NAVEGACIÓN SUAVE ===
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (this: HTMLAnchorElement, e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href')!);
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start',
                inline: 'nearest'
              });
            }
          });
        });

        // === UX Enhancements Script ===
        let ticking = false;

        function updateScrollProgress() {
          const scrollProgress = document.getElementById('scroll-progress-bar');
          if (!scrollProgress) return;
          
          const scrollTop = window.pageYOffset;
          const docHeight = document.documentElement.scrollHeight - window.innerHeight;
          const scrollPercent = Math.min((scrollTop / docHeight) * 100, 100);
          
          scrollProgress.style.width = scrollPercent + '%';
        }

        function toggleBackToTop() {
          const backToTop = document.getElementById('back-to-top');
          if (!backToTop) return;
          
          const scrollTop = window.pageYOffset;
          
          if (scrollTop > 300) {
            backToTop.classList.remove('opacity-0', 'pointer-events-none');
            backToTop.classList.add('opacity-100', 'pointer-events-auto', 'hover:scale-110');
          } else {
            backToTop.classList.add('opacity-0', 'pointer-events-none');
            backToTop.classList.remove('opacity-100', 'pointer-events-auto', 'hover:scale-110');
          }
        }

        function hideLoader() {
          const loader = document.getElementById('page-loader');
          if (!loader) return;
          
          setTimeout(() => {
            document.body.classList.add('page-loaded');
            loader.style.opacity = '0';
            setTimeout(() => {
              loader.style.display = 'none';
            }, 500);
          }, 800);
        }

        function handleScroll() {
          if (!ticking) {
            requestAnimationFrame(() => {
              updateScrollProgress();
              toggleBackToTop();
              ticking = false;
            });
            ticking = true;
          }
        }

        hideLoader();
        window.addEventListener('scroll', handleScroll, { passive: true });
        
        const backToTop = document.getElementById('back-to-top');
        if (backToTop) {
          backToTop.addEventListener('click', () => {
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          });
        }
      });
    </script>
  </body>
</html>
